@startuml deposit_process
!theme plain
title Процесс открытия депозита (AS-IS)\n\nПроблемы: Ожидание 20-60 мин | Ручные расчеты в Excel | Email-коммуникации\nНет онлайн-открытия | Разрозненные системы
skinparam backgroundColor #FEFEFE

actor "Клиент" as CLIENT
participant "Кол-центр" as CC
participant "Система\nкол-центра" as CC_SYS
participant "Сотрудник\nотделения" as BRANCH
participant "АБС" as ABS
participant "Сотрудник\nбэк-офиса\n(депозиты)" as BACK_DEP
participant "Сотрудник\nбэк-офиса\n(кредиты)" as BACK_CREDIT
participant "Excel" as EXCEL
participant "Email" as EMAIL
participant "СМС-шлюз" as SMS

== Сценарий 1: Предварительный звонок в кол-центр ==
CLIENT -> CC: Звонок с вопросом\nо депозите
activate CC
CC -> CC_SYS: Создание обращения
activate CC_SYS
CC_SYS -> ABS: Передача обращения
deactivate CC_SYS
activate ABS
ABS -> BACK_DEP: Уведомление\nо новом обращении
deactivate ABS
activate BACK_DEP

alt Обычный клиент
    BACK_DEP -> EXCEL: Открытие файла\nс текущими ставками
    activate EXCEL
    note right of EXCEL
        Ставки обновляются
        ежедневно на основе:
        - Ставки ЦБ
        - Кредитного риска
        - Баланса кредитов/депозитов
    end note
    EXCEL --> BACK_DEP: Стандартная ставка
    deactivate EXCEL
else VIP клиент (большие суммы)
    BACK_DEP -> EMAIL: Запрос анализа\nкредитного риска
    activate EMAIL
    EMAIL -> BACK_CREDIT: Получение запроса
    deactivate EMAIL
    activate BACK_CREDIT
    BACK_CREDIT -> ABS: Анализ кредитного\nриска клиента
    activate ABS
    ABS --> BACK_CREDIT: Данные риска
    deactivate ABS
    BACK_CREDIT -> EMAIL: Отправка данных\nриска
    activate EMAIL
    EMAIL -> BACK_DEP: Получение данных
    deactivate EMAIL
    deactivate BACK_CREDIT
    BACK_DEP -> EXCEL: Расчет специальной\nставки
    activate EXCEL
    EXCEL --> BACK_DEP: VIP ставка
    deactivate EXCEL
end

BACK_DEP -> ABS: Сохранение ставки\nв заявке
activate ABS
ABS -> SMS: Отправка СМС\nклиенту
activate SMS
SMS -> CLIENT: СМС с предложением\nи ставкой
deactivate SMS
deactivate ABS
deactivate BACK_DEP
CC -> CLIENT: Информация\nо депозите
deactivate CC

== Сценарий 2: Визит в отделение ==
CLIENT -> BRANCH: Визит в отделение
activate BRANCH

alt Клиент после звонка (есть предрасчет)
    BRANCH -> ABS: Поиск заявки\nс рассчитанной ставкой
    activate ABS
    ABS --> BRANCH: Данные заявки\nи ставка
    deactivate ABS
    note right: Ожидание ~5 минут
else Клиент без звонка
    BRANCH -> EMAIL: Запрос расчета\nставки
    activate EMAIL
    EMAIL -> BACK_DEP: Получение запроса
    deactivate EMAIL
    activate BACK_DEP

    alt Обычная ставка
        BACK_DEP -> EXCEL: Получение\nстандартной ставки
        activate EXCEL
        EXCEL --> BACK_DEP: Ставка
        deactivate EXCEL
        note right: Ожидание ~20 минут
    else Специальная ставка
        BACK_DEP -> EMAIL: Запрос к кредитному\nотделу
        activate EMAIL
        EMAIL -> BACK_CREDIT: Анализ риска
        deactivate EMAIL
        activate BACK_CREDIT
        BACK_CREDIT -> ABS: Проверка данных
        activate ABS
        ABS --> BACK_CREDIT: Данные
        deactivate ABS
        BACK_CREDIT -> EMAIL: Результат анализа
        activate EMAIL
        EMAIL -> BACK_DEP: Данные риска
        deactivate EMAIL
        deactivate BACK_CREDIT
        BACK_DEP -> EXCEL: Расчет ставки
        activate EXCEL
        EXCEL --> BACK_DEP: Специальная ставка
        deactivate EXCEL
        note right: Ожидание до 1 часа
    end

    BACK_DEP -> EMAIL: Отправка ставки
    activate EMAIL
    EMAIL -> BRANCH: Получение ставки
    deactivate EMAIL
    deactivate BACK_DEP
end

BRANCH -> CLIENT: Озвучивание условий\nи ставки
CLIENT -> BRANCH: Согласие на открытие
BRANCH -> ABS: Создание депозита
activate ABS
ABS --> BRANCH: Документы для подписи
deactivate ABS
BRANCH -> CLIENT: Выдача документов
CLIENT -> BRANCH: Подписанные документы
BRANCH -> ABS: Загрузка подписанных\nдокументов
activate ABS
ABS --> BRANCH: Подтверждение
deactivate ABS
BRANCH -> CLIENT: Депозит открыт
deactivate BRANCH

@enduml
